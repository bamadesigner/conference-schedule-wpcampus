!function($){"use strict";const KEYMAP_enter=13,KEYMAP_space=32;function get_conf_sch_item_time_display(date){var hour=date.getHours(),display=date.getFullMinutes();return hour>12?display=hour-12+":"+display+" p.m.":(display=hour+":"+display,display+=12==hour?" p.m.":" a.m."),display}function sort_conf_schedule_by_day(schedule,header,tzOffset){var local_dt=new Date,currentDTGMT=new Date(Date.UTC(local_dt.getUTCFullYear(),local_dt.getUTCMonth(),local_dt.getUTCDate(),local_dt.getUTCHours(),local_dt.getUTCMinutes(),local_dt.getUTCSeconds())),actualOffset=conf_sch_get_timezone_offset(local_dt),displayOffset=0;tzOffset!=actualOffset&&(displayOffset=tzOffset-actualOffset);var scheduleByDay={};for(var dayKey in $.each(schedule,function(index,item){if(void 0===item.event_dt_gmt||!item.event_dt_gmt)return!0;var itemStartDTGMT=conf_sch_get_utc_date(item.event_dt_gmt),itemEndDTGMT=item.event_end_dt_gmt?conf_sch_get_utc_date(item.event_end_dt_gmt):conf_sch_get_utc_date(item.event_dt_gmt);0!==displayOffset&&(itemStartDTGMT=conf_sch_adjust_date_offset(itemStartDTGMT,displayOffset),itemEndDTGMT=conf_sch_adjust_date_offset(itemEndDTGMT,displayOffset));var eventDayIndex=itemStartDTGMT.getFullYear()+"-"+itemStartDTGMT.getFullMonth()+"-"+itemStartDTGMT.getFullDate(),eventTimeIndex=itemStartDTGMT.getFullHours()+":"+itemStartDTGMT.getFullMinutes();eventTimeIndex+=":"+itemEndDTGMT.getFullHours()+":"+itemEndDTGMT.getFullMinutes();var date,inProgress=!1,inPast=!1,inFuture=!1;currentDTGMT>=itemStartDTGMT?currentDTGMT<itemEndDTGMT?inProgress=!0:inPast=!0:inFuture=!0,void 0===scheduleByDay[eventDayIndex]?scheduleByDay[eventDayIndex]={start_dt:itemStartDTGMT,end_dt:itemEndDTGMT,displayOffset:displayOffset,day:conf_sch_get_weekday(itemStartDTGMT),day_display:(date=itemStartDTGMT,conf_sch_get_weekday(date)+", "+conf_sch_get_month(date)+" "+date.getDate()+", "+date.getFullYear()),eventTypes:[item.event_type],header:header,inProgress:inProgress,inPast:inPast,inFuture:inFuture,rows:{},children:[]}:(item.event_type&&$.inArray(item.event_type,scheduleByDay[eventDayIndex].eventTypes)<0&&scheduleByDay[eventDayIndex].eventTypes.push(item.event_type),inProgress&&!scheduleByDay[eventDayIndex].inProgress&&(scheduleByDay[eventDayIndex].inProgress=inProgress),inPast&&!scheduleByDay[eventDayIndex].inPast&&(scheduleByDay[eventDayIndex].inPast=inPast),inFuture&&!scheduleByDay[eventDayIndex].inFuture&&(scheduleByDay[eventDayIndex].inFuture=inFuture),itemEndDTGMT>scheduleByDay[eventDayIndex].end_dt&&(scheduleByDay[eventDayIndex].end_dt=itemEndDTGMT)),item.event_links=conf_sch_get_item_links(item),item.displayOffset=displayOffset,item.parent>0?scheduleByDay[eventDayIndex].children.push(item):(void 0===scheduleByDay[eventDayIndex].rows[eventTimeIndex]?scheduleByDay[eventDayIndex].rows[eventTimeIndex]={date:eventDayIndex,start_dt:itemStartDTGMT,end_dt:itemEndDTGMT,displayOffset:displayOffset,start_time_display:get_conf_sch_item_time_display(itemStartDTGMT),end_time_display:get_conf_sch_item_time_display(itemEndDTGMT),eventTypes:[item.event_type],header:header,inProgress:inProgress,inPast:inPast,inFuture:inFuture,events:[]}:itemEndDTGMT>scheduleByDay[eventDayIndex].rows[eventTimeIndex].end_dt&&(scheduleByDay[eventDayIndex].rows[eventTimeIndex].end_dt=itemEndDTGMT),item.event_type&&$.inArray(item.event_type,scheduleByDay[eventDayIndex].rows[eventTimeIndex].eventTypes)<0&&scheduleByDay[eventDayIndex].rows[eventTimeIndex].eventTypes.push(item.event_type),scheduleByDay[eventDayIndex].rows[eventTimeIndex].events.push(item))}),scheduleByDay)if(scheduleByDay.hasOwnProperty(dayKey)){var day=scheduleByDay[dayKey];day&&day.children&&day.children.length&&$.each(day.children,function(index,child){if(!child.parent||!day.rows)return!1;for(var timeRowKey in day.rows)if(day.rows.hasOwnProperty(timeRowKey)){var timeRow=day.rows[timeRowKey];timeRow&&timeRow.events.length&&$.each(timeRow.events,function(index,event){event.id===child.parent&&(null===event.event_children&&(event.event_children=[]),event.event_children.push(child))})}})}return scheduleByDay}$(document).ready(function(){$(".conf-sch-container").each(function(){$(this).render_conf_schedule()}),$(window).on("resize.conf_schedule_active, scroll.conf_schedule_active",function(e){$(".conf-sch-container").each(function(){$(this).conf_schedule_check_active()})})}),$.fn.get_conf_schedule=function(){var $conf_sch_container=$(this),apiQuery="";return void 0!==$conf_sch_container.data("date")&&""!=$conf_sch_container.data("date")&&(apiQuery+="?conf_sch_event_date="+$conf_sch_container.data("date")),void 0!==$conf_sch_container.data("location")&&""!=$conf_sch_container.data("location")&&(apiQuery+="?conf_sch_event_location="+$conf_sch_container.data("location")),$.ajax({url:conf_sch.wp_api_route+"schedule"+apiQuery,type:"GET",dataType:"json",async:!0,cache:!1})},$.fn.print_conf_schedule_error=function(errorMsg){var $conf_sch_container=$(this),$contentArea=$conf_sch_container.find(".conference-schedule");void 0!==errorMsg&&""!=errorMsg||(errorMsg=conf_sch.error_msg);var $errorArea=$contentArea.find(".conf-sch-error");$errorArea.length?$contentArea.fadeOut(500,function(){$contentArea.hide(),$errorArea.html(errorMsg),$conf_sch_container.addClass("error").removeClass("loading"),$contentArea.fadeIn(500)}):($errorArea=$('<div class="conf-sch-error">'+errorMsg+"</div>"),$contentArea.fadeOut(500,function(){$contentArea.hide().prepend($errorArea),$conf_sch_container.addClass("error").removeClass("loading"),$contentArea.fadeIn(500)}))},Date.prototype.getFullMonth=function(){return this.getMonth()<10?"0"+this.getMonth():this.getMonth()},Date.prototype.getFullDate=function(){return this.getDate()<10?"0"+this.getDate():this.getDate()},Date.prototype.getFullHours=function(){return this.getHours()<10?"0"+this.getHours():this.getHours()},Date.prototype.getFullMinutes=function(){return this.getMinutes()<10?"0"+this.getMinutes():this.getMinutes()},$.fn.populate_conf_schedule=function(schedule,the_proposals){var $conf_sch_container=$(this),$conf_schedule=$conf_sch_container.find(".conference-schedule"),conf_sch_templ=null,conf_sch_ls_templ=null;if(void 0===schedule||""==schedule||!schedule.length)return $conf_sch_container.print_conf_schedule_error(),!1;var conf_sch_templ_content=$("#conference-schedule-template").html();void 0!==conf_sch_templ_content&&conf_sch_templ_content&&(conf_sch_templ=Handlebars.compile(conf_sch_templ_content));var conf_sch_ls_templ_content=$("#conf-schedule-watch-list-template").html();if(void 0!==conf_sch_ls_templ_content&&conf_sch_ls_templ_content&&(conf_sch_ls_templ=Handlebars.compile(conf_sch_ls_templ_content)),!conf_sch_templ)return $conf_sch_container.print_conf_schedule_error(),!1;var tzOffset=$conf_sch_container.get_conf_schedule_tz_offset(),scheduleSpeakersCount=0,proposals={};$.each(the_proposals,function(index,proposal){proposal.ID&&(proposals["proposal"+proposal.ID]=proposal)}),$.each(schedule,function(index,item){var proposal=null;"session"==item.event_type&&(item.proposal>0&&"proposal"+item.proposal in proposals&&(proposal=proposals["proposal"+item.proposal]),proposal&&"confirmed"==proposal.proposal_status?(item=conf_schedule_update_schedule_item_from_proposal(item,proposal)).speakers.length&&(scheduleSpeakersCount+=item.speakers.length):item=conf_schedule_reset_schedule_item(item))});var scheduleByDay=sort_conf_schedule_by_day(schedule,$conf_sch_container.data("header"),tzOffset);if(void 0===scheduleByDay||""==scheduleByDay||$.isEmptyObject(scheduleByDay))return $conf_sch_container.print_conf_schedule_error(),!1;$conf_schedule.html(conf_sch_templ(scheduleByDay));var $conf_sch_watch_list=$conf_sch_container.find(".conference-schedule-watch-list");if($conf_sch_watch_list.length){var livestream_list_html="";$.each(schedule,function(index,item){"session"==item.event_type&&!1!==item.session_livestream_url&&(livestream_list_html+=conf_sch_ls_templ(item))}),$conf_sch_container.find(".current-sessions-header").length||$('<h2 class="current-sessions-header">Current Sessions</h2>').insertBefore($conf_sch_watch_list),livestream_list_html||(livestream_list_html='<p class="conf-sch-watch-message"><em>'+conf_sch.no_streams+"</em></p>"),$conf_sch_watch_list.html(livestream_list_html)}$conf_sch_container.data("speakersCount",scheduleSpeakersCount),$conf_sch_container.conf_schedule_add_tz_filter(tzOffset),$conf_sch_container.conf_schedule_add_buttons(),$conf_sch_container.conf_schedule_add_actions(),$conf_sch_container.conf_schedule_check_active(),$(window).off("resize.conf_schedule_load, scroll.conf_schedule_load"),$conf_sch_container.removeClass("loading"),$conf_sch_container.find(".conf-sch-loading").removeAttr("style");var refreshSchedule=setTimeout(function(){clearTimeout(refreshSchedule),$conf_sch_container.refresh_conf_sch_container()},6e5)},$.fn.get_conf_schedule_tz_offset=function(){var $conf_sch_container=$(this);return void 0!==$conf_sch_container.data("tzoffset")&&""!=$conf_sch_container.data("tzoffset")?parseInt($conf_sch_container.data("tzoffset")):conf_sch_get_timezone_offset()},$.fn.render_conf_schedule=function(refresh){var dfd=$.Deferred(),$conf_sch_container=$(this);return $conf_sch_container.addClass("loading"),$conf_sch_container.get_conf_schedule().done(function(schedule){$.ajax({url:conf_sch.ajaxurl,type:"GET",dataType:"json",async:!0,cache:!0,data:{action:"conf_sch_get_proposals"}}).done(function(proposals){$conf_sch_container.populate_conf_schedule(schedule,proposals),dfd.resolve($conf_sch_container)})}),dfd.promise()},$.fn.conf_schedule_add_actions=function(){var $conf_sch_container=$(this);$conf_sch_container.find(".schedule-show-toggle").on("click",function(e){var $scheduleToggle=$(this),$scheduleByDay=$scheduleToggle.closest(".schedule-by-day");$scheduleByDay.hasClass("schedule-show")?($scheduleByDay.removeClass("schedule-show"),$scheduleToggle.text($scheduleToggle.data("show"))):($scheduleByDay.addClass("schedule-show"),$scheduleToggle.text($scheduleToggle.data("hide")))}),$conf_sch_container.find(".schedule-go-current").on("click keyup",function(e){var giveFocus=!1;if("keyup"==e.type){if($.inArray(e.keyCode,[KEYMAP_enter,KEYMAP_space])<0)return;e.preventDefault(),giveFocus=!0}else e.preventDefault();var $sessionInProgress=$(this).closest(".conf-sch-container").find(".conference-schedule").find(".schedule-row.status-in-progress:first");$sessionInProgress.length>0&&$("html,body").animate({scrollTop:$sessionInProgress.offset().top},500,function(){giveFocus&&$sessionInProgress.find("*:tabbable:first").focus()})}),$conf_sch_container.find(".schedule-go-top").on("click keyup",function(e){var giveFocus=!1;if("keyup"==e.type){if($.inArray(e.keyCode,[KEYMAP_enter,KEYMAP_space])<0)return;e.preventDefault(),giveFocus=!0}else e.preventDefault();var $schedule=$(this).closest(".conf-sch-container").find(".conference-schedule");$schedule.length>0&&$("html, body").animate({scrollTop:$schedule.offset().top},500,function(){giveFocus&&$schedule.find("*:tabbable:first").focus()})}),$conf_sch_container.find(".schedule-refresh").on("click keyup",function(e){var giveFocus=!1;if("keyup"==e.type){if($.inArray(e.keyCode,[KEYMAP_enter,KEYMAP_space])<0)return;e.preventDefault(),giveFocus=!0}else e.preventDefault();var refreshButton=$(this),refreshButtonIndex=giveFocus?$conf_sch_container.find(".schedule-refresh").index(refreshButton):0;refreshButton.closest(".conf-sch-container").refresh_conf_sch_container().done(function($container){giveFocus&&$container.find(".schedule-refresh").eq(refreshButtonIndex).focus()})})},$.fn.conf_schedule_add_tz_filter=function(tzOffset){var $conf_sch_container=$(this),$conf_schedule_pre=$conf_sch_container.find(".conf-sch-pre"),$messageContainer=$('<div class="conf-sch-tz-message"></div>'),timezones=conf_schedule_get_timezones(),$timezoneDropdown=((new Date).isDstObserved(),$('<select class="conf-sch-tz-filter" aria-label="Select the timezone for the schedule."></select>'));timezones.forEach(function(value,index){var offset=value.offset,label=value.label?value.label:"",offsetMessage=conf_sch_get_offset_message(offset);label?label+=" ("+offsetMessage+")":label=offsetMessage;var $option=$('<option value="'+offset+'">'+label+"</option>");tzOffset===offset&&$option.prop("selected",!0),$timezoneDropdown.append($option)}),$timezoneDropdown.on("change",function(e){e.preventDefault(),$conf_sch_container.data("tzoffset",$(this).val()),$conf_sch_container.refresh_conf_sch_container().done(function($container){$container.find(".conf-sch-tz-filter").focus()})});$messageContainer.html('<span class="conf-sch-tz-label">All times are listed in:</span> ').append($timezoneDropdown),$conf_schedule_pre.find(".conf-sch-tz-message").length>0?$conf_schedule_pre.find(".conf-sch-tz-message").replaceWith($messageContainer):$conf_schedule_pre.append($messageContainer)},$.fn.conf_schedule_add_buttons=function(){var $conf_sch_container=$(this),$conf_schedule=$conf_sch_container.find(".conference-schedule"),$conf_schedule_pre=$conf_sch_container.find(".conf-sch-pre"),$conf_schedule_post=$conf_sch_container.find(".conf-sch-post"),$scheduleTopButtons=$('<div class="schedule-nav-buttons nav-top"></div>'),$scheduleBottomButtons=$('<div class="schedule-nav-buttons nav-bottom"></div>'),$scheduleSideButtons=$('<div class="schedule-side-buttons"></div>');if($conf_schedule.find(".schedule-row.status-in-progress:first").length>0){if(!conf_sch.is_watch_page&&$(".schedule-event .event-link.event-livestream").length>0){var $watchSession=$('<a class="button schedule-video highlight" href="'+conf_sch.watch_url+'"><span>'+conf_sch.watch_message+"</span></a>");$watchSession.clone(!0).appendTo($scheduleTopButtons),$scheduleSideButtons.append($watchSession)}var $jumpSession=$('<button class="schedule-go-current highlight"><span>'+conf_sch.jump_message+"</span></button>");$jumpSession.clone(!0).appendTo($scheduleTopButtons),$scheduleSideButtons.append($jumpSession),$scheduleTopButtons.addClass("has-highlight")}$conf_sch_container.data("speakersCount")>0&&$('<a class="button" href="'+conf_sch.speakers_url+'">'+conf_sch.speakers_message+"</a>").clone().appendTo($scheduleTopButtons);var $goToTop=$('<button class="schedule-go-top"><span>'+conf_sch.top_message+"</span></button>");$scheduleSideButtons.append($goToTop);var $refreshButton=$('<button class="schedule-refresh"><span>'+conf_sch.refresh+"</span></button>");$scheduleSideButtons.append($refreshButton),$conf_schedule_pre.find(".schedule-nav-buttons").length>0?$conf_schedule_pre.find(".schedule-nav-buttons").replaceWith($scheduleTopButtons):$conf_schedule_pre.append($scheduleTopButtons),$conf_schedule_post.find(".schedule-nav-buttons").length>0?$conf_schedule_post.find(".schedule-nav-buttons").replaceWith($scheduleBottomButtons):$conf_schedule_post.append($scheduleBottomButtons).append($scheduleSideButtons),$conf_schedule_post.find(".schedule-side-buttons").length>0?$conf_schedule_post.find(".schedule-side-buttons").replaceWith($scheduleSideButtons):$conf_schedule_post.append($scheduleSideButtons)},$.fn.conf_schedule_check_active=function(){var $conf_sch_container=$(this);$conf_sch_container.conf_sch_is_in_viewport()?$conf_sch_container.addClass("active"):$conf_sch_container.removeClass("active").removeAttr("style")},$.fn.refresh_conf_sch_container=function(){var $conf_sch_container=$(this);return $(window).on("resize.conf_schedule_load, scroll.conf_schedule_load",function(e){$(".conf-sch-container.loading").each(function(){$(this).set_conf_sch_container_loading()})}),$conf_sch_container.set_conf_sch_container_loading(),$conf_sch_container.render_conf_schedule(!0)},$.fn.set_conf_sch_container_loading=function(){var $conf_sch_container=$(this),$conf_sch_loading=$conf_sch_container.find(".conf-sch-loading"),windowScrollTop=$(window).scrollTop(),windowHeight=$(window).height(),containerTop=$conf_sch_container.offset().top,containerBottom=containerTop+containerHeight,containerY=containerTop-windowScrollTop,containerHeight=$conf_sch_container.outerHeight(),containerLoadHeight=windowHeight,containerLoadTop=0,containerLoadCSS={};return containerY>0?containerLoadHeight-=containerY:containerY<0&&(containerLoadTop=Math.abs(containerY)),containerBottom<windowScrollTop+windowHeight&&(containerLoadHeight=containerHeight-windowScrollTop+containerTop),containerLoadHeight<100&&(containerLoadHeight=100),containerLoadTop>containerHeight-100&&(containerLoadTop=containerHeight-100),null!==containerLoadHeight&&(containerLoadCSS.height=containerLoadHeight),null!==containerLoadTop&&(containerLoadCSS.top=containerLoadTop),$conf_sch_loading.css(containerLoadCSS),$conf_sch_container},$.fn.conf_sch_is_in_viewport=function(){var elementTop=$(this).offset().top,elementBottom=elementTop+$(this).outerHeight(),viewportTop=$(window).scrollTop(),viewportBottom=viewportTop+$(window).height();return elementBottom>viewportTop&&elementTop<viewportBottom},Handlebars.registerHelper("toggle_show_button",function(options){return new Handlebars.SafeString('<button class="schedule-show-toggle" data-show="Show past sessions" data-hide="Hide past sessions">Show past sessions</button>')}),Handlebars.registerHelper("event_title",function(options){var $new_title=this.title.rendered;return void 0!==$new_title&&$new_title?(this.link_to_post&&void 0!==this.link&&this.link&&($new_title='<a href="'+this.link+'">'+$new_title+"</a>"),new Handlebars.SafeString('<h3 class="event-title">'+$new_title+"</h3>")):null}),Handlebars.registerHelper("event_excerpt",function(options){return"session"==this.event_type?null:""!=this.excerpt.rendered?new Handlebars.SafeString('<div class="event-excerpt">'+this.excerpt.rendered+"</div>"):null}),Handlebars.registerHelper("event_children_class",function(options){if(!this.event_children)return"";var classes=[],childTime=null,sameTime=!0,childLocation=null,sameLocation=!0;return $.each(this.event_children,function(index,child){!1!==sameTime&&(null===childTime?childTime=child.event_dt_gmt:child.event_dt_gmt!=childTime&&(sameTime=!1)),!1!==sameLocation&&(child.event_location&&child.event_location.ID?null===childLocation?childLocation=child.event_location.ID:child.event_location.ID!=childLocation&&(sameLocation=!1):sameLocation=!1)}),!0===sameTime&&classes.push("has-same-time"),!0===sameLocation&&classes.push("has-same-location")," "+classes.join(" ")}),Handlebars.registerHelper("schedule_event_class",function(options){var classes=[];return this.parent&&classes.push("event-child"),this.event_type&&classes.push(this.event_type),this.event_children&&classes.push("event-parent")," "+classes.join(" ")}),Handlebars.registerHelper("event_links_class",function(options){if(!this.event_links)return null;var linkCount=0;for(var key in this.event_links)if(this.event_links.hasOwnProperty(key)){var obj=this.event_links[key];$.isArray(obj)?linkCount+=obj.length:linkCount++}return linkCount>0?" has-event-links has-event-links-"+linkCount:""})}(jQuery);